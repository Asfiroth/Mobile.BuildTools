<?xml version="1.0" encoding="utf-8" ?>
<Project>

  <UsingTask TaskName="Mobile.BuildTools.Tasks.TemplateManifestTask"
             AssemblyFile="$(_MobileBuildToolsParentBuildDirectory)/Mobile.BuildTools.dll"/>

  <Import Project="$(MSBuildThisFileDirectory)Mobile.BuildTools.ManifestsShared.targets"/>

  <Target Name="HandleAndroidManifest"
          AfterTargets="_GenerateJavaStubs"
          Condition=" $(IsAndroidProject) ">
    <TemplateManifestTask ProjectDirectory="$(MSBuildProjectDirectory)"
                          Prefix="$(ManifestVariablePrefix)"
                          Token="$(ManifestToken)"
                          ManifestTemplatePath="$(TemlateAppManifest)"
                          ManifestOutputPath="$(TemlateAppManifest)"
                          SdkShortFrameworkIdentifier="$(_SdkShortFrameworkIdentifier)"
                          DebugOutput="$(MobileBuildToolsDebug)" />
  </Target>

  <Target Name="_CollectAPK"
          BeforeTargets="APKCopyToStagingDirectory">

    <ItemGroup>
      <__Generated_APK Include="$(OutputPath)\**\*.apk" />
    </ItemGroup>

    <Message Text="@(__Generated_APK)" />

  </Target>

  <Target Name="APKCopyToStagingDirectory"
          AfterTargets="_CreateBaseApk;_CollectAPK"
          DependsOnTargets="_CreateBaseApk;_CollectAPK"
          Condition=" '$(DisableBuildToolsArtifactCopy)' != 'false' And !'$(IsAppCenter)' "
          Inputs="@(__Generated_APK)"
          Outputs="@(__Generated_APK -> '$(BuildToolsArtifactOutputPath)%(Filename)%(Extension)')">

    <Copy SourceFiles="$(__Generated_APK)"
          DestinationFolder="$(BuildToolsArtifactOutputPath)" />

  </Target>
  
</Project>