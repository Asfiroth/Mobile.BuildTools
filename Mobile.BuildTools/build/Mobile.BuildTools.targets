<Project>

  <UsingTask TaskName="Mobile.BuildTools.Tools.SecretsJsonTask" AssemblyFile="net461/Mobile.BuildTools.dll"/>
  <UsingTask TaskName="Mobile.BuildTools.Tools.TemplateManifestTask" AssemblyFile="net461/Mobile.BuildTools.dll"/>

  <Target Name="TemplateManifest" 
          BeforeTargets="CoreCompile;_CoreXamlG;XamlG;XamlC;Build">
    <PropertyGroup>
      <BuildResourcesDirectoryName Condition=" '$(BuildResourcesDirectoryName)' == '' ">build</BuildResourcesDirectoryName>
      <BuildResourcesDirRootPath Condition=" '$(BuildResourcesDirRootPath)' == '' ">$([System.IO.Path]::Combine($(SolutionDir), $(BuildResourcesDirectoryName)))</BuildResourcesDirRootPath>
      <InfoPlistTemplateName Condition=" '$(InfoPlistTemplateName)' == '' ">BuildTemplateInfo.plist</InfoPlistTemplateName>
      <AndroidManifestTemplateName Condition=" '$(AndroidManifestTemplateName)' == '' ">AndroidTemplateManifest.xml</AndroidManifestTemplateName>
      <TemplateManifestPath Condition=" '$(IsAndroidProject)' ">$([System.IO.Path]::Combine('$(BuildResourcesDirRootPath)', '$(AndroidManifestTemplateName)'))</TemplateManifestPath>
      <ManifestDestinationPath Condition=" '$(IsAndroidProject)' ">$([System.IO.Path]::Combine('$(MSBuildProjectDirectory)', "Properties", "AndroidManifest.xml"))</ManifestDestinationPath>
      <TemplateManifestPath Condition=" '$(IsiOSProject)' ">$([System.IO.Path]::Combine('$(BuildResourcesDirRootPath)', '$(InfoPlistTemplateName)'))</TemplateManifestPath>
      <ManifestDestinationPath Condition=" '$(IsiOSProject)' ">$([System.IO.Path]::Combine('$(MSBuildProjectDirectory)', "Info.plist"))</ManifestDestinationPath>
      <ManifestVariablePrefix Condition=" '$(ManifestVariablePrefix)' == '' ">Manifest_</ManifestVariablePrefix>
    </PropertyGroup>

    <Message Text="Checking for Platform Template Configurations to Copy" />

    <TemplateManifestTask Prefix="$(ManifestVariablePrefix)"
                          Token="$(ManifestToken)"
                          ManifestTemplatePath="$(TemplateManifestPath)"
                          ManifestOutputPath="$(ManifestDestinationPath)" />

  </Target>

  <Target Name="Secrets" BeforeTargets="CoreCompile;_CoreXamlG;XamlG;XamlC;Build">
    <PropertyGroup>
      <SecretsScriptLocation>$(MSBuildThisFileDirectory)Secrets.ps1</SecretsScriptLocation>
      <JsonSecretsFileName Condition=" '$(JsonSecretsFileName)' == '' ">secrets.json</JsonSecretsFileName>
      <JsonSecretsFilePath>$([System.IO.Path]::Combine("$(ProjectDir)", "$(JsonSecretsFileName)"))</JsonSecretsFilePath>
      <SecretsOutputFileName Condition=" '$(SecretsOutputFileName)' == '' ">Helpers/Secrets.cs</SecretsOutputFileName>
    </PropertyGroup>

    <SecretsJsonTask ProjectBasePath="$(MSBuildProjectDirectory)"
                     SecretsClassName="$(SecretsClassName)"
                     SecretsJsonFilePath="$(JsonSecretsFilePath)"
                     RootNamespace="$(RootNamespace)"
                     OutputPath="$(SecretsOutputPath)" />

  </Target>

</Project>